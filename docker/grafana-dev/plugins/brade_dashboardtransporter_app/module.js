/* [create-plugin] version: 6.7.6 */
/* [create-plugin] plugin: brade-dashboardtransporter-app@1.0.0 */
define(["@grafana/ui","module","@grafana/runtime","@grafana/data","react"],(e,t,r,n,a)=>(()=>{"use strict";var o={7(t){t.exports=e},308(e){e.exports=t},531(e){e.exports=r},781(e){e.exports=n},959(e){e.exports=a}},l={};function i(e){var t=l[e];if(void 0!==t)return t.exports;var r=l[e]={exports:{}};return o[e](r,r.exports,i),r.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var r in t)i.o(t,r)&&!i.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.p="public/plugins/brade-dashboardtransporter-app/";var s={};i.r(s),i.d(s,{plugin:()=>x});var c=i(308),d=i.n(c);i.p=d()&&d().uri?d().uri.slice(0,d().uri.lastIndexOf("/")+1):"public/plugins/brade-dashboardtransporter-app/";var u=i(781),p=i(959),m=i.n(p),b=i(7),g=i(531);function v(e,t,r,n,a,o,l){try{var i=e[o](l),s=i.value}catch(e){return void r(e)}i.done?t(s):Promise.resolve(s).then(n,a)}function E(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var o=e.apply(t,r);function l(e){v(o,n,a,l,i,"next",e)}function i(e){v(o,n,a,l,i,"throw",e)}l(void 0)})}}function h(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){h(e,t,r[t])})}return e}function y(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}),e}const x=(new u.AppPlugin).addConfigPage({title:"Importar Dashboards",icon:"cloud-upload",id:"import",body:()=>{const[e,t]=(0,p.useState)([]),[r,n]=(0,p.useState)([]),[a,o]=(0,p.useState)({}),[l,i]=(0,p.useState)({environments:!1,dashboards:!1,import:!1}),[s,c]=(0,p.useState)(null),[d,u]=(0,p.useState)(null),[v,h]=(0,p.useState)({sourceEnv:"dev",targetEnv:"hml",folderUid:"",requestedBy:"",uids:[]});(0,p.useEffect)(()=>{E(function*(){i(e=>y(f({},e),{environments:!0}));try{const e=yield(0,g.getBackendSrv)().get("http://localhost:8080/environments");t(e),e.length>0&&h(t=>y(f({},t),{sourceEnv:e[0].id,targetEnv:e.length>1?e[1].id:e[0].id}))}catch(e){c("Erro ao carregar ambientes"),console.error(e)}finally{i(e=>y(f({},e),{environments:!1}))}})()},[]),(0,p.useEffect)(()=>{E(function*(){if(v.sourceEnv){i(e=>y(f({},e),{dashboards:!0})),o({});try{const e=yield(0,g.getBackendSrv)().get(`http://localhost:8080/dashboards?env=${v.sourceEnv}`);n(e)}catch(e){c(`Erro ao carregar dashboards do ambiente ${v.sourceEnv}`),console.error(e)}finally{i(e=>y(f({},e),{dashboards:!1}))}}})()},[v.sourceEnv]);const x=()=>{const e=r.every(e=>a[e.uid]),t={};e?r.forEach(e=>t[e.uid]=!1):r.forEach(e=>t[e.uid]=!0),o(t);const n=Object.keys(t).filter(e=>t[e]);h(e=>y(f({},e),{uids:n}))},O=(e,t)=>{h(r=>y(f({},r),{[e]:t}))},S=e.map(e=>({label:e.name,value:e.id}));return l.environments?m().createElement("div",{style:{padding:"32px",textAlign:"center"}},m().createElement(b.LoadingPlaceholder,{text:"Carregando ambientes..."})):m().createElement("div",{style:{padding:"24px",maxWidth:"1200px",margin:"0 auto"}},m().createElement(b.VerticalGroup,{spacing:"lg"},m().createElement("div",null,m().createElement("h2",null,"Dashboard Transporter"),m().createElement("p",{style:{color:"#999"}},"Transporte dashboards entre ambientes Grafana e aplique permissões automaticamente")),s&&m().createElement(b.Alert,{title:"Erro",severity:"error",onRemove:()=>c(null)},s),d&&m().createElement(b.Alert,{title:"Sucesso",severity:"success",onRemove:()=>u(null)},d),m().createElement("div",{style:{background:"#1e1e1e",padding:"20px",borderRadius:"4px",border:"1px solid #2c3235"}},m().createElement("h4",null,"Configuração da Importação"),m().createElement(b.VerticalGroup,{spacing:"md"},m().createElement(b.HorizontalGroup,{spacing:"lg",wrap:!0},m().createElement(b.Field,{label:"Ambiente de Origem"},m().createElement(b.Select,{options:S,value:v.sourceEnv,onChange:e=>O("sourceEnv",null==e?void 0:e.value),width:30})),m().createElement(b.Field,{label:"Ambiente de Destino"},m().createElement(b.Select,{options:S.filter(e=>e.value!==v.sourceEnv),value:v.targetEnv,onChange:e=>O("targetEnv",null==e?void 0:e.value),width:30})),m().createElement(b.Field,{label:"Pasta (opcional)",description:"Deixe vazio para pasta raiz (General)"},m().createElement(b.Input,{placeholder:"Ex: minha-pasta",value:v.folderUid,onChange:e=>O("folderUid",e.currentTarget.value),width:30})),m().createElement(b.Field,{label:"Usuário Destino",required:!0,description:"Receberá permissão de Editor"},m().createElement(b.Input,{placeholder:"Ex: usuario@empresa.com",value:v.requestedBy,onChange:e=>O("requestedBy",e.currentTarget.value),width:30}))))),m().createElement("div",{style:{background:"#1e1e1e",padding:"20px",borderRadius:"4px",border:"1px solid #2c3235"}},m().createElement(b.HorizontalGroup,{justify:"space-between",align:"center"},m().createElement("h4",null,"Dashboards Disponíveis (",r.length,")"),m().createElement("div",null,m().createElement("span",{style:{marginRight:"16px",color:"#999"}},v.uids.length," selecionado(s)"),m().createElement(b.Button,{variant:"secondary",size:"sm",onClick:x},r.every(e=>a[e.uid])?"Desmarcar Todos":"Selecionar Todos"))),l.dashboards?m().createElement("div",{style:{padding:"32px",textAlign:"center"}},m().createElement(b.LoadingPlaceholder,{text:"Carregando dashboards..."})):0===r.length?m().createElement(b.Alert,{title:"Nenhum dashboard encontrado",severity:"info"},"Não há dashboards disponíveis no ambiente selecionado."):m().createElement("div",{style:{maxHeight:"400px",overflowY:"auto",marginTop:"16px"}},m().createElement("table",{className:"filter-table",style:{width:"100%"}},m().createElement("thead",null,m().createElement("tr",null,m().createElement("th",{style:{width:"40px"}},m().createElement(b.Checkbox,{value:r.every(e=>a[e.uid]),onChange:x})),m().createElement("th",null,"Título"),m().createElement("th",null,"UID"))),m().createElement("tbody",null,r.map(e=>m().createElement("tr",{key:e.uid},m().createElement("td",null,m().createElement(b.Checkbox,{value:!!a[e.uid],onChange:()=>{return t=e.uid,void o(e=>{const r=y(f({},e),{[t]:!e[t]}),n=Object.keys(r).filter(e=>r[e]);return h(e=>y(f({},e),{uids:n})),r});var t}})),m().createElement("td",null,m().createElement(b.HorizontalGroup,{spacing:"sm"},m().createElement(b.Icon,{name:"apps"}),m().createElement("span",null,e.title||"Sem título"))),m().createElement("td",null,m().createElement("code",null,e.uid)))))))),m().createElement(b.HorizontalGroup,null,m().createElement(b.Button,{variant:"primary",size:"lg",onClick:()=>E(function*(){if(0!==v.uids.length)if(v.requestedBy.trim())if(v.sourceEnv!==v.targetEnv){i(e=>y(f({},e),{import:!0})),c(null),u(null);try{const e=yield(0,g.getBackendSrv)().post("http://localhost:8080/dashboards/import/batch",v);u(`Importação concluída! ${e.count} dashboard(s) importado(s) com sucesso.`),o({}),h(e=>y(f({},e),{uids:[]}))}catch(t){var e;const r=(null===(e=t.data)||void 0===e?void 0:e.message)||t.message||"Erro ao importar dashboards";c(r),console.error("Import error:",t)}finally{i(e=>y(f({},e),{import:!1}))}}else c("Ambiente de origem e destino não podem ser iguais");else c("Informe o usuário que receberá permissões");else c("Selecione ao menos um dashboard para importar")})(),disabled:l.import||0===v.uids.length||!v.requestedBy},l.import?"Importando...":"Importar Dashboards"),v.uids.length>0&&m().createElement("span",{style:{color:"#999",marginLeft:"16px"}},m().createElement(b.Icon,{name:"info-circle"})," ",v.uids.length," dashboard(s) serão importados")),m().createElement("div",{style:{background:"#1b1b1f",padding:"16px",borderRadius:"4px",fontSize:"12px",color:"#999"}},m().createElement(b.HorizontalGroup,null,m().createElement(b.Icon,{name:"info-circle"}),m().createElement("span",null,m().createElement("strong",null,"Atenção:")," Dashboards existentes no destino com o mesmo UID serão sobrescritos. O usuário especificado receberá permissão de Editor em todos os dashboards importados.")))))}});return s})());
//# sourceMappingURL=module.js.map